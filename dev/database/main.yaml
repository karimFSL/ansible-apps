root_dir: /apps

backup_dir: /data/backups
# You can choose seconds, minutes, hours, days, or weeks by specifying the first letter of any of those words (e.g., “1w”).
backup_ttl: 1w

extra_dirs: 
  - /data
  - /data/deployment-manager-postgres

apps:
  deployment-manager-postgres:
    type: database
    image: postgres
    version: 16.3-alpine
    internal_port: 5432
    external_port: 5432
    command: ["-c", "ssl=on", "-c", "ssl_cert_file=/var/lib/postgresql/server.crt", "-c", "ssl_key_file=/var/lib/postgresql/server.key", "-c", "logging_collector=on",  "-c", "log_statement=all"]
    env_vars:
      ENABLE_SSL: true
      POSTGRES_MULTIPLE_DATABASES: "migration,bluegreen"
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          63363936373261636433643035323330666132663931353936333735666231613863346566376132
          6239646365393231653466636266376161393664333165310a363162326462663863346237663765
          38613833633335663632313731613139306462623539343162366662333837333664373563313831
          3665653438623039380a626363393438623434663335653434636366626564623638333132623135
          65383031313237353136353234343366316563313132316432646262666635353833
      # Service account
      DB_SA_USERNAME: "deployment_manager"
      DB_SA_PASSWORD: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          61643566656264386237323836383866316463386664653931643031386135323862656635303965
          3266633364633562616239663166383037623963623835390a366131306162353332626637333631
          63333237333361633664633832343335383239633030346430323161643164353333626266323436
          6339633864616566650a613835373033633731343933643930373464636137323666313463343434
          63316364663730386536366139313932663631343561633865306533333433343631316431313562
          3934656139306339643365646338363138653333656564393363
    volumes:
      - ./deployment-manager-postgres/config/create-multiple-postgresql-databases.sh:/docker-entrypoint-initdb.d/create-multiple-postgresql-databases.sh
      - /data/deployment-manager-postgres:/var/lib/postgresql/data
      - ./deployment-manager-postgres/config/server.crt:/var/lib/postgresql/server.crt:ro
      - ./deployment-manager-postgres/config/server.key:/var/lib/postgresql/server.key:ro
